# Manual Test Checklist for #8.3.1, #8.4.1, #8.5.1, and #8.6.2

This checklist validates the API behavior for centralized configuration, structured logging, correlation IDs, error contract shape, and health/readiness endpoints.

All items were manually tested and verified as working on 02/19/26

## Start the API

```bash
cd /Users/justinpaoletta/Desktop/PROJECTS/APPS/BitStockerz/apps/api
npm install
npm run start:dev
```

The API listens on `http://localhost:3000` with the `/api` prefix.

Optional: write logs to file while testing:

```bash
LOG_TO_FILE=true LOG_FILE_PATH=./logs/api-manual-test.log npm run start:dev
```

## Checklist

1. Health endpoint returns OK
   ```bash
   curl -i http://localhost:3000/api/health/live
   ```
   Expect `200` and `{"status":"ok"}`.

2. Readiness endpoint returns ready when optional checks are not configured
   ```bash
   curl -i http://localhost:3000/api/health/ready
   ```
   Expect `200` and JSON containing:
   - `ready: true`
   - `status: "ok"`
   - `timestamp` (ISO string)
   - `checks.database.status: "not_configured"` (when `DATABASE_URL` is unset)
   - `checks.marketData.status: "not_configured"` (when `MARKET_DATA_HEALTH_URL` is unset)

3. Config validation fails fast on invalid environment values
   ```bash
   PORT=abc npm run start:dev
   ```
   Expect startup to fail immediately with an `Invalid configuration` message.

4. Readiness endpoint returns 503 when a configured core dependency is down
   Stop the existing API process, then run:
   ```bash
   DATABASE_URL=postgres://127.0.0.1:1/bitstockerz READINESS_TIMEOUT_MS=300 npm run start:dev
   ```
   In another terminal:
   ```bash
   curl -i http://localhost:3000/api/health/ready
   ```
   Expect `503` and JSON containing:
   - `ready: false`
   - `status: "degraded"`
   - `checks.database.status: "down"`

5. Strategy create (valid payload)
   ```bash
   curl -i -X POST http://localhost:3000/api/strategies \
     -H "Content-Type: application/json" \
     -d '{"name":"Test Strat","asset_type":"EQUITY","timeframe":"1d"}'
   ```
   Expect `200` and a JSON body with `id`, `name`, `asset_type`, `timeframe`.

6. Validation errors (RFC7807 shape + requestId)
   ```bash
   curl -i -X POST http://localhost:3000/api/strategies \
     -H "Content-Type: application/json" \
     -d '{"name":123}'
   ```
   Expect `400` and a JSON body containing `type`, `title`, `status`, `detail`, `instance`, `code`, `requestId`, and `fieldErrors`.

7. Error contract routes
   ```bash
   curl -i http://localhost:3000/api/error-test/unauthorized
   curl -i http://localhost:3000/api/error-test/forbidden
   curl -i http://localhost:3000/api/error-test/conflict
   curl -i http://localhost:3000/api/error-test/rate-limited
   curl -i http://localhost:3000/api/error-test/internal
   ```
   Expect RFC7807-shaped responses with `code`, `status`, and `requestId`.

8. Correlation ID echo and body consistency
   ```bash
   curl -i -H "x-request-id: manual-123" http://localhost:3000/api/health/live
   curl -i -H "x-request-id: manual-123" http://localhost:3000/api/error-test/unauthorized
   ```
   Expect `x-request-id: manual-123` in response headers and `requestId: "manual-123"` in the error response body.

9. Log redaction for sensitive headers
   ```bash
   curl -i -H "Authorization: Bearer secret" -H "Cookie: session=abc" http://localhost:3000/api/health/live
   ```
   Verify server logs do not include raw `Authorization` or `Cookie` values.

10. Config-driven file logging behavior
   Stop the API and run:
   ```bash
   LOG_TO_FILE=true LOG_FILE_PATH=./logs/api-manual-test.log npm run start:dev
   ```
   Hit any endpoint:
   ```bash
   curl -i http://localhost:3000/api/health/live
   ```
   Expect log output to be written to `./logs/api-manual-test.log`.
